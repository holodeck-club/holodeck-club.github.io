!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerSystem("audio-visualizer",{init:function(){this.analysers={},this.context=new AudioContext},getOrCreateAnalyser:function(e){var t=this.context,i=this.analysers,n=t.createAnalyser(),r=e.src,s=r.getAttribute("src");return new Promise(function(a){r.addEventListener("canplay",function(){if(i[s])return void a(i[s]);var u=t.createMediaElementSource(r);u.connect(n),n.connect(t.destination),n.smoothingTimeConstant=e.smoothingTimeConstant,n.fftSize=e.fftSize,i[s]=n,a(i[s])})})}}),AFRAME.registerComponent("audio-visualizer",{schema:{fftSize:{"default":2048},smoothingTimeConstant:{"default":.8},src:{type:"selector"},unique:{"default":!1}},init:function(){this.analyser=null,this.spectrum=null},update:function(){function e(e){t.analyser=e,t.spectrum=new Uint8Array(t.analyser.frequencyBinCount),t.el.emit("audio-analyser-ready",{analyser:e})}var t=this,i=this.data,n=this.system;i.src&&(i.unique?n.createAnalyser(i).then(e):n.getOrCreateAnalyser(i).then(e))},tick:function(){this.analyser&&this.analyser.getByteFrequencyData(this.spectrum)}}),AFRAME.registerComponent("audio-visualizer-kick",{dependencies:["audio-visualizer"],schema:{decay:{"default":.02},frequency:{"default":[0,10]},threshold:{"default":.3}},init:function(){this.currentThreshold=this.data.threshold,this.kicking=!1},tick:function(){var e=this.data,t=this.el;if(t.components["audio-visualizer"].spectrum){var i=this.maxAmplitude(e.frequency);if(i>this.currentThreshold&&i>e.threshold){if(this.kicking)return;this.kicking=!0,t.emit("audio-visualizer-kick-start",{currentThreshold:this.currentThreshold,magnitude:i})}else this.currentThreshold-=e.decay,this.kicking&&(this.kicking=!1,t.emit("audio-visualizer-kick-end",{currentThreshold:this.currentThreshold,magnitude:i}))}},maxAmplitude:function(e){var t=0,i=this.el.components["audio-visualizer"].spectrum;if(!e.length)return e<i.length?i[~~e]:null;for(var n=e[0],r=e[1];r>=n;n++)i[n]>t&&(t=i[n]);return t}})}]);